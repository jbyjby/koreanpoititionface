<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="얼굴 사진을 AI로 분석하여 정치 성향을 예측하는 사이트이다. 내 얼굴이 진보의 상인지 보수의 상인지 재미로 확인 할 수 있다."
    />
    <meta property="og:title" content="정치 관상 테스트" />
    <meta
      property="og:description"
      content="얼굴 사진을 AI로 분석하여 정치 성향을 예측하는 사이트. 내 얼굴이 진보의 상인지 보수의 상인지 확인해 보세요."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://github.com/jbyjby/koreanpoititionface/blob/main/img/mainog.png?raw=true" />
    <meta property="og:image" content="https://github.com/jbyjby/koreanpoititionface/blob/main/img/mainog.png?raw=true" />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7270568015111547"
      crossorigin="anonymous"
    ></script>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="stylesheet" href="/style.css" type="text/css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!-- 카카오톡 -->

    <script
      src="https://t1.kakaocdn.net/kakao_js_sdk/2.6.0/kakao.min.js"
      integrity="sha384-6MFdIr0zOira1CHQkedUqJVql0YtcZA1P0nbPrQYJXVJZUkTk/oX4U9GhUIs3/z8"
      crossorigin="anonymous"
    ></script>
    <script src="js/share.js"></script>
    <script>
      // Kakao SDK 초기화
      Kakao.init("38f29a9f6e62558e30e1318a0713e849");
      console.log("카카오톡 초기화 상태:", Kakao.isInitialized());
    </script>
    <meta name="naver-site-verification" content="be89642fd3fd004e3631b85ceb6815e6fcc70a44" />
    <title>정치관상테스트</title>
  </head>
  <body>
    <div class="title">
      <h4 style="font-size: 2vw">내가 <span class="title-blue">진보</span>의 상인가? <span class="title-red">보수</span>의 상인가?</h4>
      <div class="main-title">
        <img class="title-img" src="/img/title.jpg" alt="투표스탬프" />
        <h1>정치 관상 테스트</h1>
      </div>
    </div>

    <div>
      <div class="politician">
        <h3 style="font-size: 130%">대한민국 대표 정치인 평균 얼굴</h3>
        <div class="politician-script-detail0">한국의 대표 정치인 얼굴을 정치 성향별로 합성해 보았습니다.</div>

        <div class="politicianImg">
          <img class="politicianImg-detail" id="politicianImg0" src="/img/left1.jpg" alt="민주 남자" />
          <img class="politicianImg-detail" id="politicianImg1" src="/img/left2.jpg" alt="민주 여자" />
          <img class="politicianImg-detail" id="politicianImg2" src="/img/right1.jpg" alt="국힘 남자 " />
          <img class="politicianImg-detail" id="politicianImg3" src="/img/right2.jpg" alt="국힘 여자" />
        </div>
        <div class="politician-script">
          <div class="politician-script-detail">진보 성향 정치인 평균 얼굴</div>
          <div class="politician-script-detail">보수 성향 정치인 평균 얼굴</div>
        </div>
      </div>
    </div>
    <ins class="kakao_ad_area" style="display: none" data-ad-unit="DAN-KcPf2zAWcygqSgGo" data-ad-width="320" data-ad-height="100"></ins>
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>

    <h2 style="text-align: center; font-size: 5vw">내가 진보의 상일까? 보수의 상일까?</h2>
    <p style="text-align: center; font-size: 58%">⬇️⬇️관상에 따라 정치 성향을 알 수 있을까요? 재미로만 해주세요. 테스트하기🥰⬇️⬇️</p>

    <div class="toggle">
      <p style="font-size: 80%; padding-top: 0.8rem; padding-right: 0.8rem">여자</p>
      <input type="checkbox" id="gender" />
      <label for="gender">
        <span class="knob"><i></i></span>
      </label>
      <p style="font-size: 80%; padding-top: 0.8rem; padding-left: 0.8rem">남자</p>
    </div>

    <div class="img-container">
      <img class="sideImg" src="/img/한동훈.jpg" alt="한동훈" />
      <div class="uploadFile">
        <form id="file-upload-form" class="uploader">
          <input id="file-upload" type="file" name="fileUpload" accept="image/*" />
          <label for="file-upload" id="file-drag" style="padding: 10% 0">
            <img id="file-image" src="#" alt="Preview" class="hidden" />
            <div class="resultTitle"></div>

            <div class="start" id="start">
              <div><i class="fa fa-download" aria-hidden="true" style="font-size: 8vw"></i></div>
              <div style="font-size: 59%; width: 100%">
                AI로 분석하는데 5초정도 걸려요.<br />조금만 기다려주세요.😅<br />사진은 분석 후 바로 삭제됩니다.
              </div>
              <div><span id="file-upload-btn" class="btn btn-primary">사진 업로드</span></div>

              <div id="notimage" class="hidden" style="font-size: 60%">사진 파일(.jpg, .png 등)을 업로드 해주세요.</div>
            </div>

            <div id="file-image"></div>
            <div id="response" class="hidden">
              <!-- <div id="messages"></div> -->
              <!-- <progress class="progress" id="file-progress" value="0"><span>0</span>%</progress> -->
              <div>
                <button class="btn btn-primary d-none" id="spinner" type="button" disabled>
                  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  분석하는 중...
                </button>
              </div>
            </div>
          </label>
        </form>
      </div>
      <img class="sideImg" src="/img/이재명.jpg" alt="이재명" />
    </div>
    <!-- 공유 결과 들어올 자리 -->
    <div class="result-box">
      <div class="resultDesc"></div>
      <div id="label-container"></div>
      <div class="resultPeople"></div>
      <div class="last-button">
        <a id="shareButton" class="btn-gradient yellow small" sytle="text-align: center"> 공유하기</a>
        <a href="#" class="btn-gradient blue small" onclick="reset()" sytle="text-align: center;" onclick="reset()">다시하기</a>
      </div>
    </div>

    <ins class="kakao_ad_area" style="display: none" data-ad-unit="DAN-hcDZppdeHRFYCKL6" data-ad-width="320" data-ad-height="50"></ins>
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
    <div id="disqus_thread"></div>
    <div class="footer">© JBY, 2024. All Rights Reserved.<br />문의: jby8775@gmail.com</div>

    <!-- 댓글창 -->
    <script>
      (function () {
        // DON'T EDIT BELOW THIS LINE
        var d = document,
          s = d.createElement("script");
        s.src = "https://jby-2.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    <!-- 티쳐블 머신 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
      const reset = () => {
        location.reload();
      };

      function resetPage() {
        document.getElementById("file-image").src = "#";
        document.querySelector(".result-box").style.display = "none";
      }
      document.querySelector("button[type='button']").addEventListener("click", resetPage);
    </script>
    <script type="text/javascript">
      // More API functions here:
      // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
      // the link to your model provided by Teachable Machine export panel

      const URLman = "https://teachablemachine.withgoogle.com/models/JCPzCRcMo/";
      const URLwoman = "https://teachablemachine.withgoogle.com/models/ryFGsFriI/";
      let model, labelContainer, maxPredictions;

      // 토글 부분
      let gender = "2";
      document.querySelector("#gender").addEventListener("change", function () {
        gender = this.checked ? "1" : "2"; // 토글 값에 따라 성별 설정
        console.log(gender);
      });

      async function init1() {
        const modelURL = gender === "1" ? URLman + "model.json" : URLwoman + "model.json";
        const metadataURL = gender === "1" ? URLman + "metadata.json" : URLwoman + "metadata.json";

        // 모델 및 메타데이터 로드
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // 돔에 엘리먼트 추가 div가 2개 생김
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) {
          // and class labels
          labelContainer.appendChild(document.createElement("div"));
        }
      }

      // intit1과 동시에 예측하기
      async function predict() {
        let uploadImg = document.getElementById("file-image"); //업로드한 이미지
        const prediction = await model.predict(uploadImg, false);
        prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
        console.log(prediction);
        console.log(prediction[0].className);
        let result, shareButton;
        switch (prediction[0].className) {
          case "보수남":
            result = data.보수남;
            shareButton = data.보수남.className;
            break;
          case "진보남":
            result = data.진보남;
            shareButton = data.진보남.className;
            break;
          case "보수여":
            result = data.보수여;
            shareButton = data.보수여.className;
            break;
          case "진보여":
            result = data.진보여;
            shareButton = data.진보여.className;
            break;
          default:
            result = data.몰라;
        }
        //공유하기 버튼
        //       function updateShareButton(className) {
        //   let shareButton = document.getElementById("shareButton");
        //   switch (className) {
        //     case "보수남":
        //       shareButton.href = "javascript:shareMessage0()";
        //       break;
        //     case "진보남":
        //       shareButton.href = "javascript:shareMessage1()";
        //       break;
        //     case "보수여":
        //       shareButton.href = "javascript:shareMessage2()";
        //       break;
        //     case "진보여":
        //       shareButton.href = "javascript:shareMessage3()";
        //       break;
        //     default:
        //       shareButton.href = "#"; // 기본값으로 설정
        //   }
        // }
        // let className = prediction[0].className;
        //   updateShareButton(className);

        //결과 제목과 설명
        document.querySelector(".resultTitle").innerHTML = result.title;
        document.querySelector(".resultDesc").innerHTML = result.description;
        document.querySelector(".resultPeople").innerHTML = `같은 성향 정치인: ${result.people}`;
        const resultBox = document.querySelector(".result-box");
        resultBox.style.display = "block";
        document.getElementById("shareButton").href = shareButton;
        //프로그래스바
        for (let i = 0; i < maxPredictions; i++) {
          let predictionName;
          predictionName =
            prediction[i].className === "보수남" || prediction[i].className === "보수여"
              ? "보수"
              : prediction[i].className === "진보남" || prediction[i].className === "진보여"
              ? "진보"
              : prediction[i].className;

          labelContainer.childNodes[
            i
          ].innerHTML = `<div class="prediction">${predictionName} <div class="progress-bar" style="background-color:#dedede">
          <div class="progress" id ="progress${[i]}" style="height: 100%; border-radius:10px; width: ${
            Math.round(prediction[i].probability.toFixed(2) * 99 + 1) + "%"
          };"><span style="position: absolute">${Math.round(prediction[i].probability.toFixed(2) * 100) + "%"}</span></div></div>
      </div>`;
        }

        const totalNum = Math.round(prediction[i].probability.toFixed(2) * 100 + 1); // 전체 %
        const bar = document.querySelector(".progress"); // 프로그레스 바 요소 선택

        let t = 0;
        const barAnimation = setInterval(() => {
          bar.style.width = t + "%"; // 너비 설정
          t++; // 너비 증가
          if (t >= totalNum) clearInterval(barAnimation); // 최대 너비에 도달하면 애니메이션 중지
        }, 10);
      }

      // 사진 업로드
      //
      function ekUpload() {
        function Init() {
          console.log("Upload Initialised");

          var fileSelect = document.getElementById("file-upload"),
            fileDrag = document.getElementById("file-drag");

          fileSelect.addEventListener("change", fileSelectHandler, false);

          // Is XHR2 available?
          var xhr = new XMLHttpRequest();
          if (xhr.upload) {
            // File Drop
            fileDrag.addEventListener("dragover", fileDragHover, false);
            fileDrag.addEventListener("dragleave", fileDragHover, false);
            fileDrag.addEventListener("drop", fileSelectHandler, false);
          }
        }

        function fileDragHover(e) {
          var fileDrag = document.getElementById("file-drag");

          e.stopPropagation();
          e.preventDefault();

          fileDrag.className = e.type === "dragover" ? "hover" : "modal-body file-upload";
        }

        function fileSelectHandler(e) {
          // Fetch FileList object
          var files = e.target.files || e.dataTransfer.files;

          // Cancel event and hover styling
          fileDragHover(e);

          // Process all File objects
          for (var i = 0, f; (f = files[i]); i++) {
            parseFile(f);
            uploadFile(f);
          }
        }

        // Output
        function output(msg) {
          // Response
          var m = document.getElementById("messages");
          //   m.innerHTML = msg;
        }

        function parseFile(file) {
          document.querySelector("#spinner").className = "btn btn-primary";
          console.log(file.name);
          output("<strong>" + encodeURI(file.name) + "</strong>");

          // 이미지 파일 여부 확인
          var isGood = /\.(?=gif|jpg|png|jpeg)/gi.test(file.name);
          if (isGood) {
            var reader = new FileReader(); // 파일을 읽기 위한 FileReader 객체 생성
            reader.onload = function (e) {
              // 읽기 동작이 성공적으로 완료되었을 때 호출되는 이벤트 핸들러
              document.getElementById("start").classList.add("hidden");
              document.getElementById("response").classList.remove("hidden");
              document.getElementById("notimage").classList.add("hidden");
              // Thumbnail Preview
              var preview = document.getElementById("file-image");
              preview.classList.remove("hidden");
              preview.src = e.target.result; // 읽어들인 파일의 URL을 이미지 태그의 src 속성에 지정하여 미리보기 표시
              init1().then(() => {
                console.log("모델 불러오기 완료");
                document.querySelector("#spinner").className = "btn btn-primary d-none";
                predict();
              });
            };
            reader.readAsDataURL(file); // 파일을 읽어 Data URL로 변환
          } else {
            // 이미지 파일이 아닌 경우
            document.getElementById("file-image").classList.add("hidden");
            document.getElementById("notimage").classList.remove("hidden");
            document.getElementById("start").classList.remove("hidden");
            document.getElementById("response").classList.add("hidden");
            document.getElementById("file-upload-form").reset();
          }
        }

        function setProgressMaxValue(e) {
          var pBar = document.getElementById("file-progress");

          if (e.lengthComputable) {
            pBar.max = e.total;
          }
        }

        function updateFileProgress(e) {
          var pBar = document.getElementById("file-progress");

          if (e.lengthComputable) {
            pBar.value = e.loaded;
          }
        }

        function uploadFile(file) {
          var xhr = new XMLHttpRequest(),
            fileInput = document.getElementById("class-roster-file"),
            pBar = document.getElementById("file-progress"),
            fileSizeLimit = 1024; // In MB
          if (xhr.upload) {
            // Check if file is less than x MB
            if (file.size <= fileSizeLimit * 1024 * 1024) {
              // Progress bar
              pBar.style.display = "inline";
              xhr.upload.addEventListener("loadstart", setProgressMaxValue, false);
              xhr.upload.addEventListener("progress", updateFileProgress, false);

              // File received / failed
              xhr.onreadystatechange = function (e) {
                if (xhr.readyState == 4) {
                  // Everything is good!
                  // progress.className = (xhr.status == 200 ? "success" : "failure");
                  // document.location.reload(true);
                }
              };

              // Start upload
              xhr.open("POST", document.getElementById("file-upload-form").action, true);
              xhr.setRequestHeader("X-File-Name", file.name);
              xhr.setRequestHeader("X-File-Size", file.size);
              xhr.setRequestHeader("Content-Type", "multipart/form-data");
              xhr.send(file);
            } else {
              output("Please upload a smaller file (< " + fileSizeLimit + " MB).");
            }
          }
        }

        // Check for the various File API support.
        if (window.File && window.FileList && window.FileReader) {
          Init();
        } else {
          document.getElementById("file-drag").style.display = "none";
        }
      }
      ekUpload();
    </script>
    <script src="js/share.js/" charset="UTF-8"></script>

    <script src="js/data.js" charset="UTF-8"></script>
  </body>
</html>
